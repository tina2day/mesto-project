(()=>{"use strict";var t={d:(e,n)=>{for(var o in n)t.o(n,o)&&!t.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:n[o]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};t.d({},{qK:()=>V,vm:()=>_});var e="https://nomoreparties.co/v1/apf-cohort-202",n="c597d92d-5898-4bf5-baee-08b5177a1d55",o="application/json";function r(t){return new Promise((function(e,n){var o=new Image;o.src=t,o.onload=function(){return e(!0)},o.onerror=function(){return n(new Error("Картинка не загрузилась"))}}))}function c(t,o,r,c,u){var i=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0),a=i.querySelector(".card__like-button"),l=i.querySelector(".card__like-amount"),s=i.querySelector(".card__image"),p=i.querySelector(".card__title");if(s.src=t,s.alt=o,p.textContent=o,l.textContent=r.length,i.id=u,s.addEventListener("click",(function(){V(t,o)})),r.forEach((function(t){t._id===_&&a.classList.add("card__like-button_is-active")})),c){var d=i.querySelector(".card__delete-button");d.classList.remove("card__delete-button_active-none"),d.addEventListener("click",(function(){!function(t){fetch("".concat(e,"/cards/").concat(t),{method:"DELETE",headers:{authorization:n}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(t){return t})).catch((function(t){return console.log(t)}))}(u),i.remove()}))}return a.addEventListener("click",(function(){a.classList.contains("card__like-button_is-active")?(a.classList.remove("card__like-button_is-active"),function(t){return fetch("".concat(e,"/cards/likes/").concat(t),{method:"DELETE",headers:{authorization:n}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(t){return t})).catch((function(t){return console.log(t)}))}(u).then((function(t){l.textContent=t.likes.length}))):(function(t){return fetch("".concat(e,"/cards/likes/").concat(t),{method:"PUT",headers:{authorization:n}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(t){return t})).catch((function(t){return console.log(t)}))}(u).then((function(t){l.textContent=t.likes.length})),a.classList.add("card__like-button_is-active"))})),i}var u=function(t){t.classList.remove("popup_is-opened"),document.removeEventListener("keydown",s)},i=function(t){t.classList.add("popup_is-opened"),document.addEventListener("keydown",s)};document.querySelectorAll(".popup__close").forEach((function(t){t.addEventListener("click",(function(){u(t.closest(".popup"))}))}));var a,l,s=function(t){var e=document.querySelector(".popup_is-opened");"Escape"===t.key&&u(e)},p=function(t,e,n,o){var r=t.querySelector(".".concat(e.id,"-error"));e.classList.add(o.inputErrorClass),r.textContent=n,r.classList.add(o.errorClass)},d=function(t,e,n){var o=t.querySelector(".".concat(e.id,"-error"));e.classList.remove(n.inputErrorClass),o.textContent="",o.classList.remove(n.errorClass)},f=function(t,e,n){!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?e.classList.remove(n.inactiveButtonClass):e.classList.add(n.inactiveButtonClass)},_="",m={popupFormElementSelector:".popup__form",popupElementSelector:".popup",popupContentSelector:".popup__content",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_inactive",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error_active"},y=document.querySelector(".popup_type_edit"),v=document.querySelector(".profile__edit-button"),h=document.querySelector(".popup_type_edit-image"),S=document.querySelector(".profile__image_overlay_icon"),q=h.querySelector(".popup__input_type_url"),k=h.querySelector(".popup__form"),C=document.querySelector(".popup_type_new-card"),E=document.querySelector(".profile__add-button"),b=document.querySelector(".popup_type_image"),g=b.querySelector(".popup__image"),L=b.querySelector(".popup__caption"),x=document.querySelector(".places__list"),j=document.querySelector(".places__loading-indicator"),P="",A=document.querySelector(".profile__image"),w=document.querySelector(".profile"),z=y.querySelector(".popup__input_type_name"),T=y.querySelector(".popup__input_type_description"),D=w.querySelector(".profile__title"),O=w.querySelector(".profile__description"),B=y.querySelector(".popup__form"),N=C.querySelector(".popup__input_type_card-name"),I=C.querySelector(".popup__input_type_url"),J=C.querySelector(".popup__form");function V(t,e){g.src=t,g.alt=e,L.textContent=e,i(b)}fetch("".concat(e,"/users/me"),{headers:{authorization:n}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(t){return t})).catch((function(t){return console.log(t)})).then((function(t){return _=t._id,P=t.avatar,D.textContent=t.name,O.textContent=t.about,t})).then((function(t){return A.style.backgroundImage="url(".concat(P,")")})),fetch("".concat(e,"/cards"),{headers:{authorization:n}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).catch((function(t){return console.log(t)})).then((function(t){j.style.display="block";var e=t.map((function(t,e){return r(t.link).then((function(){return{card:t,isValid:!0}})).catch((function(e){return console.log("Не удалось загрузить изображение: ".concat(t.link),e),{card:t,isValid:!1}}))}));Promise.all(e).then((function(t){t.forEach((function(t){var e=t.card;t.isValid&&x.append(c(e.link,e.name,e.likes,e.owner._id===_,e._id))}))})).finally((function(){return j.style.display="none"}))})),v.addEventListener("click",(function(){z.value=D.textContent,T.value=O.textContent,d(y,z,m),d(y,T,m),i(y)})),E.addEventListener("click",(function(){N.value="",I.value="",d(C,N,m),d(C,I,m),i(C)})),S.addEventListener("click",(function(){q.value=P,d(h,q,m),i(h)})),B.addEventListener("submit",(function(t){t.preventDefault();var r,c,i=B.querySelector(".popup__button");i.textContent="Сохранение...",(r=z.value,c=T.value,fetch("".concat(e,"/users/me"),{method:"PATCH",headers:{authorization:n,"Content-Type":o},body:JSON.stringify({name:"".concat(r),about:"".concat(c)})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(t){console.log(t)}))).then((function(){D.textContent=z.value,O.textContent=T.value,i.textContent="Сохранить",u(y)})).catch((function(t){console.log(t)})).finally((function(){return i.textContent="Сохранить"}))})),k.addEventListener("submit",(function(t){t.preventDefault(),d(h,q,m);var c,i=k.querySelector(".popup__button");i.textContent="Сохранение...",P=q.value,(c=P,r(c).then((function(){return fetch("".concat(e,"/users/me/avatar"),{method:"PATCH",headers:{authorization:n,"Content-Type":o},body:JSON.stringify({avatar:c})})})).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))).then((function(){A.style.backgroundImage="url(".concat(P,")"),i.textContent="Сохранить",u(h)})).catch((function(t){console.log(t),p(h,q,"Введённая ссылка некорректна",m)})).finally((function(){i.textContent="Сохранить"}))})),J.addEventListener("submit",(function(t){t.preventDefault();var i,a,l=J.querySelector(".popup__button");l.textContent="Сохранение...",(i=N.value,a=I.value,r(a).then((function(){return fetch("".concat(e,"/cards"),{method:"Post",headers:{authorization:n,"Content-Type":o},body:JSON.stringify({name:"".concat(i),link:"".concat(a)})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))}))).then((function(t){var e=c(I.value,N.value,t.likes,!0,t._id);x.prepend(e),l.textContent="Сохранить",u(C)})).catch((function(t){console.log(t),p(C,I,"Введённая ссылка некорректна",m)})).finally((function(){return l.textContent="Сохранить"}))})),a=m,l=Array.from(document.querySelectorAll(a.popupFormElementSelector)),Array.from(document.querySelectorAll(a.popupElementSelector)).forEach((function(t){t.addEventListener("click",(function(e){e.target.closest(a.popupContentSelector)||u(t)}))})),l.forEach((function(t){t.addEventListener("submit",(function(t){t.preventDefault()})),function(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector)),o=t.querySelector(e.submitButtonSelector);f(n,o,e),n.forEach((function(r){r.addEventListener("input",(function(){o&&f(n,o,e),function(t,e,n){e.validity.valid?d(t,e,n):p(t,e,e.validationMessage,n)}(t,r,e)}))}))}(t,a)}))})();