(()=>{"use strict";var t={d:(e,n)=>{for(var o in n)t.o(n,o)&&!t.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:n[o]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};t.d({},{qK:()=>J,vm:()=>f});var e="https://nomoreparties.co/v1/apf-cohort-202",n="c597d92d-5898-4bf5-baee-08b5177a1d55",o="application/json";function r(t){return new Promise((function(e,n){var o=new Image;o.src=t,o.onload=function(){return e(!0)},o.onerror=function(){return n(new Error("Картинка не загрузилась"))}}))}function c(t,o,r,c,u){var i=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0),a=i.querySelector(".card__like-button"),l=i.querySelector(".card__like-amount"),s=i.querySelector(".card__image"),p=i.querySelector(".card__title");if(s.src=t,s.alt=o,p.textContent=o,l.textContent=r.length,i.id=u,s.addEventListener("click",(function(){J(t,o)})),r.forEach((function(t){t._id===f&&a.classList.add("card__like-button_is-active")})),c){var d=i.querySelector(".card__delete-button");d.classList.remove("card__delete-button_active-none"),d.addEventListener("click",(function(){!function(t){fetch("".concat(e,"/cards/").concat(t),{method:"DELETE",headers:{authorization:n}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(t){return t})).catch((function(t){return console.log(t)}))}(u),i.remove()}))}return a.addEventListener("click",(function(){a.classList.contains("card__like-button_is-active")?(a.classList.remove("card__like-button_is-active"),function(t){return fetch("".concat(e,"/cards/likes/").concat(t),{method:"DELETE",headers:{authorization:n}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(t){return t})).catch((function(t){return console.log(t)}))}(u).then((function(t){l.textContent=t.likes.length}))):(function(t){return fetch("".concat(e,"/cards/likes/").concat(t),{method:"PUT",headers:{authorization:n}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(t){return t})).catch((function(t){return console.log(t)}))}(u).then((function(t){l.textContent=t.likes.length})),a.classList.add("card__like-button_is-active"))})),i}var u=function(t){t.classList.remove("popup_is-opened"),document.removeEventListener("keydown",s)},i=function(t){t.classList.add("popup_is-opened"),document.addEventListener("keydown",s)};document.querySelectorAll(".popup__close").forEach((function(t){t.addEventListener("click",(function(){u(t.closest(".popup"))}))}));var a,l,s=function(t){var e=document.querySelector(".popup_is-opened");"Escape"===t.key&&u(e)},p=function(t,e,n){var o=t.querySelector(".".concat(e.id,"-error"));e.classList.remove(n.inputErrorClass),o.textContent="",o.classList.remove(n.errorClass)},d=function(t,e,n){!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?e.classList.remove(n.inactiveButtonClass):e.classList.add(n.inactiveButtonClass)},f="",_={popupFormElementSelector:".popup__form",popupElementSelector:".popup",popupContentSelector:".popup__content",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_inactive",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error_active"},m=document.querySelector(".popup_type_edit"),y=document.querySelector(".profile__edit-button"),v=document.querySelector(".popup_type_edit-image"),h=document.querySelector(".profile__image_overlay_icon"),S=v.querySelector(".popup__input_type_url"),q=v.querySelector(".popup__form"),k=document.querySelector(".popup_type_new-card"),C=document.querySelector(".profile__add-button"),E=document.querySelector(".popup_type_image"),b=E.querySelector(".popup__image"),g=E.querySelector(".popup__caption"),L=document.querySelector(".places__list"),x=document.querySelector(".places__loading-indicator"),j="",P=document.querySelector(".profile__image"),A=document.querySelector(".profile"),w=m.querySelector(".popup__input_type_name"),z=m.querySelector(".popup__input_type_description"),T=A.querySelector(".profile__title"),D=A.querySelector(".profile__description"),O=m.querySelector(".popup__form"),B=k.querySelector(".popup__input_type_card-name"),N=k.querySelector(".popup__input_type_url"),I=k.querySelector(".popup__form");function J(t,e){b.src=t,b.alt=e,g.textContent=e,i(E)}fetch("".concat(e,"/users/me"),{headers:{authorization:n}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(t){return t})).catch((function(t){return console.log(t)})).then((function(t){return f=t._id,j=t.avatar,T.textContent=t.name,D.textContent=t.about,t})).then((function(t){return P.style.backgroundImage="url(".concat(j,")")})),fetch("".concat(e,"/cards"),{headers:{authorization:n}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).catch((function(t){return console.log(t)})).then((function(t){x.style.display="block";var e=t.map((function(t,e){return r(t.link).then((function(){return{card:t,isValid:!0}})).catch((function(e){return console.log("Не удалось загрузить изображение: ".concat(t.link),e),{card:t,isValid:!1}}))}));Promise.all(e).then((function(t){t.forEach((function(t){var e=t.card;t.isValid&&L.append(c(e.link,e.name,e.likes,e.owner._id===f,e._id))}))})).finally((function(){return x.style.display="none"}))})),y.addEventListener("click",(function(){w.value=T.textContent,z.value=D.textContent,p(m,w,_),p(m,z,_),i(m)})),C.addEventListener("click",(function(){B.value="",N.value="",p(k,B,_),p(k,N,_),i(k)})),h.addEventListener("click",(function(){S.value=j,p(v,S,_),i(v)})),O.addEventListener("submit",(function(t){t.preventDefault();var r,c,i=O.querySelector(".popup__button");i.textContent="Сохранение...",(r=w.value,c=z.value,fetch("".concat(e,"/users/me"),{method:"PATCH",headers:{authorization:n,"Content-Type":o},body:JSON.stringify({name:"".concat(r),about:"".concat(c)})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(t){console.log(t)}))).then((function(){T.textContent=w.value,D.textContent=z.value,i.textContent="Сохранить",u(m)})).catch((function(t){console.log(t)})).finally((function(){return i.textContent="Сохранить"}))})),q.addEventListener("submit",(function(t){t.preventDefault();var c,i=q.querySelector(".popup__button");i.textContent="Сохранение...",j=S.value,(c=j,r(c).then((function(){return fetch("".concat(e,"/users/me/avatar"),{method:"PATCH",headers:{authorization:n,"Content-Type":o},body:JSON.stringify({avatar:c})})})).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))).then((function(){P.style.backgroundImage="url(".concat(j,")"),i.textContent="Сохранить",u(v)})).catch((function(t){console.log(t)})).finally((function(){return i.textContent="Сохранить"}))})),I.addEventListener("submit",(function(t){t.preventDefault();var i,a,l=I.querySelector(".popup__button");l.textContent="Сохранение...",(i=B.value,a=N.value,r(a).then((function(){return fetch("".concat(e,"/cards"),{method:"Post",headers:{authorization:n,"Content-Type":o},body:JSON.stringify({name:"".concat(i),link:"".concat(a)})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))}))).then((function(t){var e=c(N.value,B.value,t.likes,!0,t._id);L.prepend(e),l.textContent="Сохранить",u(k)})).catch((function(t){console.log(t)})).finally((function(){return l.textContent="Сохранить"}))})),a=_,l=Array.from(document.querySelectorAll(a.popupFormElementSelector)),Array.from(document.querySelectorAll(a.popupElementSelector)).forEach((function(t){t.addEventListener("click",(function(e){e.target.closest(a.popupContentSelector)||u(t)}))})),l.forEach((function(t){t.addEventListener("submit",(function(t){t.preventDefault()})),function(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector)),o=t.querySelector(e.submitButtonSelector);d(n,o,e),n.forEach((function(r){r.addEventListener("input",(function(){o&&d(n,o,e),function(t,e,n){e.validity.valid?p(t,e,n):function(t,e,n,o){var r=t.querySelector(".".concat(e.id,"-error"));e.classList.add(o.inputErrorClass),r.textContent=n,r.classList.add(o.errorClass)}(t,e,e.validationMessage,n)}(t,r,e)}))}))}(t,a)}))})();